<!DOCTYPE html>
    <html>
    <head>
        <meta charset="UTF-8">
        <title>Signals</title>
        <style>
/* From extension vscode.github */
.vscode-dark img[src$=\#gh-light-mode-only],
.vscode-light img[src$=\#gh-dark-mode-only] {
    display: none;
}

/* From extension vscode.markdown-math */
@font-face{font-family:KaTeX_AMS;src:url(fonts/KaTeX_AMS-Regular.woff2) format("woff2"),url(fonts/KaTeX_AMS-Regular.woff) format("woff"),url(fonts/KaTeX_AMS-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Caligraphic;src:url(fonts/KaTeX_Caligraphic-Bold.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Bold.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Caligraphic;src:url(fonts/KaTeX_Caligraphic-Regular.woff2) format("woff2"),url(fonts/KaTeX_Caligraphic-Regular.woff) format("woff"),url(fonts/KaTeX_Caligraphic-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Fraktur;src:url(fonts/KaTeX_Fraktur-Bold.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Bold.woff) format("woff"),url(fonts/KaTeX_Fraktur-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Fraktur;src:url(fonts/KaTeX_Fraktur-Regular.woff2) format("woff2"),url(fonts/KaTeX_Fraktur-Regular.woff) format("woff"),url(fonts/KaTeX_Fraktur-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Main;src:url(fonts/KaTeX_Main-Bold.woff2) format("woff2"),url(fonts/KaTeX_Main-Bold.woff) format("woff"),url(fonts/KaTeX_Main-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:KaTeX_Main;src:url(fonts/KaTeX_Main-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Main-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Main-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:KaTeX_Main;src:url(fonts/KaTeX_Main-Italic.woff2) format("woff2"),url(fonts/KaTeX_Main-Italic.woff) format("woff"),url(fonts/KaTeX_Main-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:KaTeX_Main;src:url(fonts/KaTeX_Main-Regular.woff2) format("woff2"),url(fonts/KaTeX_Main-Regular.woff) format("woff"),url(fonts/KaTeX_Main-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Math;src:url(fonts/KaTeX_Math-BoldItalic.woff2) format("woff2"),url(fonts/KaTeX_Math-BoldItalic.woff) format("woff"),url(fonts/KaTeX_Math-BoldItalic.ttf) format("truetype");font-weight:700;font-style:italic}@font-face{font-family:KaTeX_Math;src:url(fonts/KaTeX_Math-Italic.woff2) format("woff2"),url(fonts/KaTeX_Math-Italic.woff) format("woff"),url(fonts/KaTeX_Math-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:"KaTeX_SansSerif";src:url(fonts/KaTeX_SansSerif-Bold.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Bold.woff) format("woff"),url(fonts/KaTeX_SansSerif-Bold.ttf) format("truetype");font-weight:700;font-style:normal}@font-face{font-family:"KaTeX_SansSerif";src:url(fonts/KaTeX_SansSerif-Italic.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Italic.woff) format("woff"),url(fonts/KaTeX_SansSerif-Italic.ttf) format("truetype");font-weight:400;font-style:italic}@font-face{font-family:"KaTeX_SansSerif";src:url(fonts/KaTeX_SansSerif-Regular.woff2) format("woff2"),url(fonts/KaTeX_SansSerif-Regular.woff) format("woff"),url(fonts/KaTeX_SansSerif-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Script;src:url(fonts/KaTeX_Script-Regular.woff2) format("woff2"),url(fonts/KaTeX_Script-Regular.woff) format("woff"),url(fonts/KaTeX_Script-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size1;src:url(fonts/KaTeX_Size1-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size1-Regular.woff) format("woff"),url(fonts/KaTeX_Size1-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size2;src:url(fonts/KaTeX_Size2-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size2-Regular.woff) format("woff"),url(fonts/KaTeX_Size2-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size3;src:url(fonts/KaTeX_Size3-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size3-Regular.woff) format("woff"),url(fonts/KaTeX_Size3-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Size4;src:url(fonts/KaTeX_Size4-Regular.woff2) format("woff2"),url(fonts/KaTeX_Size4-Regular.woff) format("woff"),url(fonts/KaTeX_Size4-Regular.ttf) format("truetype");font-weight:400;font-style:normal}@font-face{font-family:KaTeX_Typewriter;src:url(fonts/KaTeX_Typewriter-Regular.woff2) format("woff2"),url(fonts/KaTeX_Typewriter-Regular.woff) format("woff"),url(fonts/KaTeX_Typewriter-Regular.ttf) format("truetype");font-weight:400;font-style:normal}.katex{font:normal 1.21em KaTeX_Main,Times New Roman,serif;line-height:1.2;text-indent:0;text-rendering:auto;border-color:currentColor}.katex *{-ms-high-contrast-adjust:none!important}.katex .katex-version:after{content:"0.13.0"}.katex .katex-mathml{position:absolute;clip:rect(1px,1px,1px,1px);padding:0;border:0;height:1px;width:1px;overflow:hidden}.katex .katex-html>.newline{display:block}.katex .base{position:relative;white-space:nowrap;width:-webkit-min-content;width:-moz-min-content;width:min-content}.katex .base,.katex .strut{display:inline-block}.katex .textbf{font-weight:700}.katex .textit{font-style:italic}.katex .textrm{font-family:KaTeX_Main}.katex .textsf{font-family:KaTeX_SansSerif}.katex .texttt{font-family:KaTeX_Typewriter}.katex .mathnormal{font-family:KaTeX_Math;font-style:italic}.katex .mathit{font-family:KaTeX_Main;font-style:italic}.katex .mathrm{font-style:normal}.katex .mathbf{font-family:KaTeX_Main;font-weight:700}.katex .boldsymbol{font-family:KaTeX_Math;font-weight:700;font-style:italic}.katex .amsrm,.katex .mathbb,.katex .textbb{font-family:KaTeX_AMS}.katex .mathcal{font-family:KaTeX_Caligraphic}.katex .mathfrak,.katex .textfrak{font-family:KaTeX_Fraktur}.katex .mathtt{font-family:KaTeX_Typewriter}.katex .mathscr,.katex .textscr{font-family:KaTeX_Script}.katex .mathsf,.katex .textsf{font-family:KaTeX_SansSerif}.katex .mathboldsf,.katex .textboldsf{font-family:KaTeX_SansSerif;font-weight:700}.katex .mathitsf,.katex .textitsf{font-family:KaTeX_SansSerif;font-style:italic}.katex .mainrm{font-family:KaTeX_Main;font-style:normal}.katex .vlist-t{display:inline-table;table-layout:fixed;border-collapse:collapse}.katex .vlist-r{display:table-row}.katex .vlist{display:table-cell;vertical-align:bottom;position:relative}.katex .vlist>span{display:block;height:0;position:relative}.katex .vlist>span>span{display:inline-block}.katex .vlist>span>.pstrut{overflow:hidden;width:0}.katex .vlist-t2{margin-right:-2px}.katex .vlist-s{display:table-cell;vertical-align:bottom;font-size:1px;width:2px;min-width:2px}.katex .vbox{display:inline-flex;flex-direction:column;align-items:baseline}.katex .hbox{width:100%}.katex .hbox,.katex .thinbox{display:inline-flex;flex-direction:row}.katex .thinbox{width:0;max-width:0}.katex .msupsub{text-align:left}.katex .mfrac>span>span{text-align:center}.katex .mfrac .frac-line{display:inline-block;width:100%;border-bottom-style:solid}.katex .hdashline,.katex .hline,.katex .mfrac .frac-line,.katex .overline .overline-line,.katex .rule,.katex .underline .underline-line{min-height:1px}.katex .mspace{display:inline-block}.katex .clap,.katex .llap,.katex .rlap{width:0;position:relative}.katex .clap>.inner,.katex .llap>.inner,.katex .rlap>.inner{position:absolute}.katex .clap>.fix,.katex .llap>.fix,.katex .rlap>.fix{display:inline-block}.katex .llap>.inner{right:0}.katex .clap>.inner,.katex .rlap>.inner{left:0}.katex .clap>.inner>span{margin-left:-50%;margin-right:50%}.katex .rule{display:inline-block;border:0 solid;position:relative}.katex .hline,.katex .overline .overline-line,.katex .underline .underline-line{display:inline-block;width:100%;border-bottom-style:solid}.katex .hdashline{display:inline-block;width:100%;border-bottom-style:dashed}.katex .sqrt>.root{margin-left:.27777778em;margin-right:-.55555556em}.katex .fontsize-ensurer.reset-size1.size1,.katex .sizing.reset-size1.size1{font-size:1em}.katex .fontsize-ensurer.reset-size1.size2,.katex .sizing.reset-size1.size2{font-size:1.2em}.katex .fontsize-ensurer.reset-size1.size3,.katex .sizing.reset-size1.size3{font-size:1.4em}.katex .fontsize-ensurer.reset-size1.size4,.katex .sizing.reset-size1.size4{font-size:1.6em}.katex .fontsize-ensurer.reset-size1.size5,.katex .sizing.reset-size1.size5{font-size:1.8em}.katex .fontsize-ensurer.reset-size1.size6,.katex .sizing.reset-size1.size6{font-size:2em}.katex .fontsize-ensurer.reset-size1.size7,.katex .sizing.reset-size1.size7{font-size:2.4em}.katex .fontsize-ensurer.reset-size1.size8,.katex .sizing.reset-size1.size8{font-size:2.88em}.katex .fontsize-ensurer.reset-size1.size9,.katex .sizing.reset-size1.size9{font-size:3.456em}.katex .fontsize-ensurer.reset-size1.size10,.katex .sizing.reset-size1.size10{font-size:4.148em}.katex .fontsize-ensurer.reset-size1.size11,.katex .sizing.reset-size1.size11{font-size:4.976em}.katex .fontsize-ensurer.reset-size2.size1,.katex .sizing.reset-size2.size1{font-size:.83333333em}.katex .fontsize-ensurer.reset-size2.size2,.katex .sizing.reset-size2.size2{font-size:1em}.katex .fontsize-ensurer.reset-size2.size3,.katex .sizing.reset-size2.size3{font-size:1.16666667em}.katex .fontsize-ensurer.reset-size2.size4,.katex .sizing.reset-size2.size4{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size2.size5,.katex .sizing.reset-size2.size5{font-size:1.5em}.katex .fontsize-ensurer.reset-size2.size6,.katex .sizing.reset-size2.size6{font-size:1.66666667em}.katex .fontsize-ensurer.reset-size2.size7,.katex .sizing.reset-size2.size7{font-size:2em}.katex .fontsize-ensurer.reset-size2.size8,.katex .sizing.reset-size2.size8{font-size:2.4em}.katex .fontsize-ensurer.reset-size2.size9,.katex .sizing.reset-size2.size9{font-size:2.88em}.katex .fontsize-ensurer.reset-size2.size10,.katex .sizing.reset-size2.size10{font-size:3.45666667em}.katex .fontsize-ensurer.reset-size2.size11,.katex .sizing.reset-size2.size11{font-size:4.14666667em}.katex .fontsize-ensurer.reset-size3.size1,.katex .sizing.reset-size3.size1{font-size:.71428571em}.katex .fontsize-ensurer.reset-size3.size2,.katex .sizing.reset-size3.size2{font-size:.85714286em}.katex .fontsize-ensurer.reset-size3.size3,.katex .sizing.reset-size3.size3{font-size:1em}.katex .fontsize-ensurer.reset-size3.size4,.katex .sizing.reset-size3.size4{font-size:1.14285714em}.katex .fontsize-ensurer.reset-size3.size5,.katex .sizing.reset-size3.size5{font-size:1.28571429em}.katex .fontsize-ensurer.reset-size3.size6,.katex .sizing.reset-size3.size6{font-size:1.42857143em}.katex .fontsize-ensurer.reset-size3.size7,.katex .sizing.reset-size3.size7{font-size:1.71428571em}.katex .fontsize-ensurer.reset-size3.size8,.katex .sizing.reset-size3.size8{font-size:2.05714286em}.katex .fontsize-ensurer.reset-size3.size9,.katex .sizing.reset-size3.size9{font-size:2.46857143em}.katex .fontsize-ensurer.reset-size3.size10,.katex .sizing.reset-size3.size10{font-size:2.96285714em}.katex .fontsize-ensurer.reset-size3.size11,.katex .sizing.reset-size3.size11{font-size:3.55428571em}.katex .fontsize-ensurer.reset-size4.size1,.katex .sizing.reset-size4.size1{font-size:.625em}.katex .fontsize-ensurer.reset-size4.size2,.katex .sizing.reset-size4.size2{font-size:.75em}.katex .fontsize-ensurer.reset-size4.size3,.katex .sizing.reset-size4.size3{font-size:.875em}.katex .fontsize-ensurer.reset-size4.size4,.katex .sizing.reset-size4.size4{font-size:1em}.katex .fontsize-ensurer.reset-size4.size5,.katex .sizing.reset-size4.size5{font-size:1.125em}.katex .fontsize-ensurer.reset-size4.size6,.katex .sizing.reset-size4.size6{font-size:1.25em}.katex .fontsize-ensurer.reset-size4.size7,.katex .sizing.reset-size4.size7{font-size:1.5em}.katex .fontsize-ensurer.reset-size4.size8,.katex .sizing.reset-size4.size8{font-size:1.8em}.katex .fontsize-ensurer.reset-size4.size9,.katex .sizing.reset-size4.size9{font-size:2.16em}.katex .fontsize-ensurer.reset-size4.size10,.katex .sizing.reset-size4.size10{font-size:2.5925em}.katex .fontsize-ensurer.reset-size4.size11,.katex .sizing.reset-size4.size11{font-size:3.11em}.katex .fontsize-ensurer.reset-size5.size1,.katex .sizing.reset-size5.size1{font-size:.55555556em}.katex .fontsize-ensurer.reset-size5.size2,.katex .sizing.reset-size5.size2{font-size:.66666667em}.katex .fontsize-ensurer.reset-size5.size3,.katex .sizing.reset-size5.size3{font-size:.77777778em}.katex .fontsize-ensurer.reset-size5.size4,.katex .sizing.reset-size5.size4{font-size:.88888889em}.katex .fontsize-ensurer.reset-size5.size5,.katex .sizing.reset-size5.size5{font-size:1em}.katex .fontsize-ensurer.reset-size5.size6,.katex .sizing.reset-size5.size6{font-size:1.11111111em}.katex .fontsize-ensurer.reset-size5.size7,.katex .sizing.reset-size5.size7{font-size:1.33333333em}.katex .fontsize-ensurer.reset-size5.size8,.katex .sizing.reset-size5.size8{font-size:1.6em}.katex .fontsize-ensurer.reset-size5.size9,.katex .sizing.reset-size5.size9{font-size:1.92em}.katex .fontsize-ensurer.reset-size5.size10,.katex .sizing.reset-size5.size10{font-size:2.30444444em}.katex .fontsize-ensurer.reset-size5.size11,.katex .sizing.reset-size5.size11{font-size:2.76444444em}.katex .fontsize-ensurer.reset-size6.size1,.katex .sizing.reset-size6.size1{font-size:.5em}.katex .fontsize-ensurer.reset-size6.size2,.katex .sizing.reset-size6.size2{font-size:.6em}.katex .fontsize-ensurer.reset-size6.size3,.katex .sizing.reset-size6.size3{font-size:.7em}.katex .fontsize-ensurer.reset-size6.size4,.katex .sizing.reset-size6.size4{font-size:.8em}.katex .fontsize-ensurer.reset-size6.size5,.katex .sizing.reset-size6.size5{font-size:.9em}.katex .fontsize-ensurer.reset-size6.size6,.katex .sizing.reset-size6.size6{font-size:1em}.katex .fontsize-ensurer.reset-size6.size7,.katex .sizing.reset-size6.size7{font-size:1.2em}.katex .fontsize-ensurer.reset-size6.size8,.katex .sizing.reset-size6.size8{font-size:1.44em}.katex .fontsize-ensurer.reset-size6.size9,.katex .sizing.reset-size6.size9{font-size:1.728em}.katex .fontsize-ensurer.reset-size6.size10,.katex .sizing.reset-size6.size10{font-size:2.074em}.katex .fontsize-ensurer.reset-size6.size11,.katex .sizing.reset-size6.size11{font-size:2.488em}.katex .fontsize-ensurer.reset-size7.size1,.katex .sizing.reset-size7.size1{font-size:.41666667em}.katex .fontsize-ensurer.reset-size7.size2,.katex .sizing.reset-size7.size2{font-size:.5em}.katex .fontsize-ensurer.reset-size7.size3,.katex .sizing.reset-size7.size3{font-size:.58333333em}.katex .fontsize-ensurer.reset-size7.size4,.katex .sizing.reset-size7.size4{font-size:.66666667em}.katex .fontsize-ensurer.reset-size7.size5,.katex .sizing.reset-size7.size5{font-size:.75em}.katex .fontsize-ensurer.reset-size7.size6,.katex .sizing.reset-size7.size6{font-size:.83333333em}.katex .fontsize-ensurer.reset-size7.size7,.katex .sizing.reset-size7.size7{font-size:1em}.katex .fontsize-ensurer.reset-size7.size8,.katex .sizing.reset-size7.size8{font-size:1.2em}.katex .fontsize-ensurer.reset-size7.size9,.katex .sizing.reset-size7.size9{font-size:1.44em}.katex .fontsize-ensurer.reset-size7.size10,.katex .sizing.reset-size7.size10{font-size:1.72833333em}.katex .fontsize-ensurer.reset-size7.size11,.katex .sizing.reset-size7.size11{font-size:2.07333333em}.katex .fontsize-ensurer.reset-size8.size1,.katex .sizing.reset-size8.size1{font-size:.34722222em}.katex .fontsize-ensurer.reset-size8.size2,.katex .sizing.reset-size8.size2{font-size:.41666667em}.katex .fontsize-ensurer.reset-size8.size3,.katex .sizing.reset-size8.size3{font-size:.48611111em}.katex .fontsize-ensurer.reset-size8.size4,.katex .sizing.reset-size8.size4{font-size:.55555556em}.katex .fontsize-ensurer.reset-size8.size5,.katex .sizing.reset-size8.size5{font-size:.625em}.katex .fontsize-ensurer.reset-size8.size6,.katex .sizing.reset-size8.size6{font-size:.69444444em}.katex .fontsize-ensurer.reset-size8.size7,.katex .sizing.reset-size8.size7{font-size:.83333333em}.katex .fontsize-ensurer.reset-size8.size8,.katex .sizing.reset-size8.size8{font-size:1em}.katex .fontsize-ensurer.reset-size8.size9,.katex .sizing.reset-size8.size9{font-size:1.2em}.katex .fontsize-ensurer.reset-size8.size10,.katex .sizing.reset-size8.size10{font-size:1.44027778em}.katex .fontsize-ensurer.reset-size8.size11,.katex .sizing.reset-size8.size11{font-size:1.72777778em}.katex .fontsize-ensurer.reset-size9.size1,.katex .sizing.reset-size9.size1{font-size:.28935185em}.katex .fontsize-ensurer.reset-size9.size2,.katex .sizing.reset-size9.size2{font-size:.34722222em}.katex .fontsize-ensurer.reset-size9.size3,.katex .sizing.reset-size9.size3{font-size:.40509259em}.katex .fontsize-ensurer.reset-size9.size4,.katex .sizing.reset-size9.size4{font-size:.46296296em}.katex .fontsize-ensurer.reset-size9.size5,.katex .sizing.reset-size9.size5{font-size:.52083333em}.katex .fontsize-ensurer.reset-size9.size6,.katex .sizing.reset-size9.size6{font-size:.5787037em}.katex .fontsize-ensurer.reset-size9.size7,.katex .sizing.reset-size9.size7{font-size:.69444444em}.katex .fontsize-ensurer.reset-size9.size8,.katex .sizing.reset-size9.size8{font-size:.83333333em}.katex .fontsize-ensurer.reset-size9.size9,.katex .sizing.reset-size9.size9{font-size:1em}.katex .fontsize-ensurer.reset-size9.size10,.katex .sizing.reset-size9.size10{font-size:1.20023148em}.katex .fontsize-ensurer.reset-size9.size11,.katex .sizing.reset-size9.size11{font-size:1.43981481em}.katex .fontsize-ensurer.reset-size10.size1,.katex .sizing.reset-size10.size1{font-size:.24108004em}.katex .fontsize-ensurer.reset-size10.size2,.katex .sizing.reset-size10.size2{font-size:.28929605em}.katex .fontsize-ensurer.reset-size10.size3,.katex .sizing.reset-size10.size3{font-size:.33751205em}.katex .fontsize-ensurer.reset-size10.size4,.katex .sizing.reset-size10.size4{font-size:.38572806em}.katex .fontsize-ensurer.reset-size10.size5,.katex .sizing.reset-size10.size5{font-size:.43394407em}.katex .fontsize-ensurer.reset-size10.size6,.katex .sizing.reset-size10.size6{font-size:.48216008em}.katex .fontsize-ensurer.reset-size10.size7,.katex .sizing.reset-size10.size7{font-size:.57859209em}.katex .fontsize-ensurer.reset-size10.size8,.katex .sizing.reset-size10.size8{font-size:.69431051em}.katex .fontsize-ensurer.reset-size10.size9,.katex .sizing.reset-size10.size9{font-size:.83317261em}.katex .fontsize-ensurer.reset-size10.size10,.katex .sizing.reset-size10.size10{font-size:1em}.katex .fontsize-ensurer.reset-size10.size11,.katex .sizing.reset-size10.size11{font-size:1.19961427em}.katex .fontsize-ensurer.reset-size11.size1,.katex .sizing.reset-size11.size1{font-size:.20096463em}.katex .fontsize-ensurer.reset-size11.size2,.katex .sizing.reset-size11.size2{font-size:.24115756em}.katex .fontsize-ensurer.reset-size11.size3,.katex .sizing.reset-size11.size3{font-size:.28135048em}.katex .fontsize-ensurer.reset-size11.size4,.katex .sizing.reset-size11.size4{font-size:.32154341em}.katex .fontsize-ensurer.reset-size11.size5,.katex .sizing.reset-size11.size5{font-size:.36173633em}.katex .fontsize-ensurer.reset-size11.size6,.katex .sizing.reset-size11.size6{font-size:.40192926em}.katex .fontsize-ensurer.reset-size11.size7,.katex .sizing.reset-size11.size7{font-size:.48231511em}.katex .fontsize-ensurer.reset-size11.size8,.katex .sizing.reset-size11.size8{font-size:.57877814em}.katex .fontsize-ensurer.reset-size11.size9,.katex .sizing.reset-size11.size9{font-size:.69453376em}.katex .fontsize-ensurer.reset-size11.size10,.katex .sizing.reset-size11.size10{font-size:.83360129em}.katex .fontsize-ensurer.reset-size11.size11,.katex .sizing.reset-size11.size11{font-size:1em}.katex .delimsizing.size1{font-family:KaTeX_Size1}.katex .delimsizing.size2{font-family:KaTeX_Size2}.katex .delimsizing.size3{font-family:KaTeX_Size3}.katex .delimsizing.size4{font-family:KaTeX_Size4}.katex .delimsizing.mult .delim-size1>span{font-family:KaTeX_Size1}.katex .delimsizing.mult .delim-size4>span{font-family:KaTeX_Size4}.katex .nulldelimiter{display:inline-block;width:.12em}.katex .delimcenter,.katex .op-symbol{position:relative}.katex .op-symbol.small-op{font-family:KaTeX_Size1}.katex .op-symbol.large-op{font-family:KaTeX_Size2}.katex .accent>.vlist-t,.katex .op-limits>.vlist-t{text-align:center}.katex .accent .accent-body{position:relative}.katex .accent .accent-body:not(.accent-full){width:0}.katex .overlay{display:block}.katex .mtable .vertical-separator{display:inline-block;min-width:1px}.katex .mtable .arraycolsep{display:inline-block}.katex .mtable .col-align-c>.vlist-t{text-align:center}.katex .mtable .col-align-l>.vlist-t{text-align:left}.katex .mtable .col-align-r>.vlist-t{text-align:right}.katex .svg-align{text-align:left}.katex svg{display:block;position:absolute;width:100%;height:inherit;fill:currentColor;stroke:currentColor;fill-rule:nonzero;fill-opacity:1;stroke-width:1;stroke-linecap:butt;stroke-linejoin:miter;stroke-miterlimit:4;stroke-dasharray:none;stroke-dashoffset:0;stroke-opacity:1}.katex svg path{stroke:none}.katex img{border-style:none;min-width:0;min-height:0;max-width:none;max-height:none}.katex .stretchy{width:100%;display:block;position:relative;overflow:hidden}.katex .stretchy:after,.katex .stretchy:before{content:""}.katex .hide-tail{width:100%;position:relative;overflow:hidden}.katex .halfarrow-left{position:absolute;left:0;width:50.2%;overflow:hidden}.katex .halfarrow-right{position:absolute;right:0;width:50.2%;overflow:hidden}.katex .brace-left{position:absolute;left:0;width:25.1%;overflow:hidden}.katex .brace-center{position:absolute;left:25%;width:50%;overflow:hidden}.katex .brace-right{position:absolute;right:0;width:25.1%;overflow:hidden}.katex .x-arrow-pad{padding:0 .5em}.katex .cd-arrow-pad{padding:0 .55556em 0 .27778em}.katex .mover,.katex .munder,.katex .x-arrow{text-align:center}.katex .boxpad{padding:0 .3em}.katex .fbox,.katex .fcolorbox{box-sizing:border-box;border:.04em solid}.katex .cancel-pad{padding:0 .2em}.katex .cancel-lap{margin-left:-.2em;margin-right:-.2em}.katex .sout{border-bottom-style:solid;border-bottom-width:.08em}.katex .angl{box-sizing:border-content;border-top:.049em solid;border-right:.049em solid;margin-right:.03889em}.katex .anglpad{padding:0 .03889em}.katex .eqn-num:before{counter-increment:katexEqnNo;content:"(" counter(katexEqnNo) ")"}.katex .mml-eqn-num:before{counter-increment:mmlEqnNo;content:"(" counter(mmlEqnNo) ")"}.katex .mtr-glue{width:50%}.katex .cd-vert-arrow{display:inline-block;position:relative}.katex .cd-label-left{display:inline-block;position:absolute;right:calc(50% + .3em);text-align:left}.katex .cd-label-right{display:inline-block;position:absolute;left:calc(50% + .3em);text-align:right}.katex-display{display:block;margin:1em 0;text-align:center}.katex-display>.katex{display:block;text-align:center;white-space:nowrap}.katex-display>.katex>.katex-html{display:block;position:relative}.katex-display>.katex>.katex-html>.tag{position:absolute;right:0}.katex-display.leqno>.katex>.katex-html>.tag{left:0;right:auto}.katex-display.fleqn>.katex{text-align:left;padding-left:2em}body{counter-reset:katexEqnNo mmlEqnNo}

/*---------------------------------------------------------------------------------------------
 *  Copyright (c) Microsoft Corporation. All rights reserved.
 *  Licensed under the MIT License. See License.txt in the project root for license information.
 *--------------------------------------------------------------------------------------------*/

.katex-error {
	color: var(--vscode-editorError-foreground);
}

</style>
        
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/markdown.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/Microsoft/vscode/extensions/markdown-language-features/media/highlight.css">
<style>
            body {
                font-family: -apple-system, BlinkMacSystemFont, 'Segoe WPC', 'Segoe UI', system-ui, 'Ubuntu', 'Droid Sans', sans-serif;
                font-size: 14px;
                line-height: 1.6;
            }
        </style>
        <style>
.task-list-item { list-style-type: none; } .task-list-item-checkbox { margin-left: -20px; vertical-align: middle; }
</style>
        
        
        
    </head>
    <body class="vscode-body vscode-light">
        <ul>
<li><a href="#signals">Signals</a>
<ul>
<li><a href="#sending-signals">Sending Signals</a>
<ul>
<li><a href="#send-signal-to-thread">Send Signal to thread</a></li>
<li><a href="#realtime-signals-sending">Realtime Signals Sending</a></li>
</ul>
</li>
<li><a href="#deliver-signals">Deliver Signals</a></li>
<li><a href="#waiting-signals">Waiting Signals</a></li>
</ul>
</li>
<li><a href="#special-signals">Special Signals</a>
<ul>
<li><a href="#sigkill-and-sigstop">SIGKILL and SIGSTOP</a></li>
<li><a href="#sigcont">SIGCONT</a></li>
<li><a href="#sigchld">SIGCHLD</a></li>
<li><a href="#hardware-generated-signals">Hardware generated signals</a></li>
</ul>
</li>
<li><a href="#signal-handler">Signal Handler</a>
<ul>
<li><a href="#signal-handler-and-thread">Signal handler and thread</a></li>
</ul>
</li>
<li><a href="#kernel-internals">Kernel Internals</a></li>
</ul>
<h1 id="signals">Signals</h1>
<p>A signal is a notification to a process that an event has occurred. Signals are sometimes described as software interrupts.</p>
<p>Process can send a signal to another process (or to itself).</p>
<p>Kernel can send signals to a process, with below scenarios:</p>
<ul>
<li>A hardware exception occurred, meaning that the hardware detected a fault condition that was notified to the kernel, which in turn sent a corresponding signal to the process concerned. Examples of hardware exceptions include executing a malformed machine-language instruction, dividing by 0, or referencing a part of memory that is inaccessible.</li>
<li>The user typed one of the terminal special characters that generate signals. These characters include the interrupt character (usually Control-C) and the suspend character (usually Control-Z).</li>
<li>A software event occurred. For example, input became available on a file descriptor, the terminal window was resized, a timer went off, the process’s CPU time limit was exceeded, or a child of this process terminated.</li>
</ul>
<p><img src="images/2022-03-01-22-18-59.png" alt=""></p>
<p><strong>Signal handler is executed by the kernel.</strong></p>
<p><img src="images/2022-03-01-22-13-42.png" alt=""></p>
<p>Refer to <a href="#kernel-internals">Kernel Internals</a></p>
<h2 id="sending-signals">Sending Signals</h2>
<p><strong>signal()</strong> - not portable
<code>sighandler_t signal(int signum, sighandler_t handler);</code></p>
<p>WARNING: the behavior of signal() varies across UNIX versions, and has also varied historically across different versions of Linux.  Avoid its use: use sigaction(2) instead.</p>
<p><strong>sigaction() system call</strong></p>
<p>The <code>sigaction()</code> system call provides more control and flexibility than <code>signal()</code> when setting the disposition of a signal.</p>
<ul>
<li><code>sigaction(int sig, const struct sigaction* act,struct sigaction* oldact)</code>
<ul>
<li><code>sig</code>: can’t be SIGKILL or SIGSTOP.</li>
<li>If <code>act</code> is NULL, <code>oldact</code> returns the current disposition.</li>
<li><code>oldact</code> can be NULL if we are not interested in it.</li>
<li>sigaction.sa_mask<br>
Defines a set of signals that should be blocked during invocation of signal handler. The signal itself is also automatically added to it before the handler is called. This prevents recursively interrupting itself. All blocked signals will be queued and delivered once later.</li>
</ul>
</li>
</ul>
<pre><code class="language-C++"><div><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sigaction</span> {</span> 
	<span class="hljs-keyword">void</span> (*sa_handler)(<span class="hljs-keyword">int</span>); 
	<span class="hljs-keyword">sigset_t</span> sa_mask; 
	<span class="hljs-keyword">int</span> sa_flags; 
        ...
};
</div></code></pre>
<p><strong>kill(pid_t pid, int sig)</strong></p>
<ul>
<li>If no process matches specified <code>pid</code>, <code>kill()</code> fails and sets errno to ESRCH (“No such process”).</li>
<li>if <code>pid</code>==0, it sends signal to all processes in current process group.</li>
<li>if <code>pid</code>&lt;-1, it sends signal to all processes in process group of &quot;-pid&quot;.</li>
<li>If a process doesn’t have permissions to send a signal to the requested pid, then <code>kill()</code> fails, setting errno to <code>EPERM</code>.</li>
</ul>
<p>If the <code>sig</code> argument is specified as 0 (the so-called null signal), then no signal is sent. Instead, <code>kill()</code> merely performs error checking to see if the process can be signaled. It can be used to to verify the existence of target PID.</p>
<p><strong>raise(int sig)</strong></p>
<p>send a signal to itself</p>
<ul>
<li>In single-thread program, it is equivalent as <code>kill(getpid(), sig)</code></li>
<li>In multi-thread program, it is implemented as <code>pthread_kill(pthread_self(), sig)</code></li>
<li>The signal is delivered immediately. Only error code is EINVAL. No need check return code.</li>
</ul>
<p><strong>killpg(pid_t pgrp, int sig)</strong></p>
<p>sends a signal to all of the members of a process group, it is equivalent to <code>kill(-pgrp, sig)</code>.</p>
<h3 id="send-signal-to-thread">Send Signal to thread</h3>
<p>无论是<code>kill()</code>还是<code>sigqueue()</code>，都只能向进程发送信号，在Linux中，要向进程内的线程发送信号，需要使用<code>tkill()</code>或者<code>tgkill()</code>：</p>
<pre><code class="language-C++"><div><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">tkill</span><span class="hljs-params">(<span class="hljs-keyword">int</span> tid, <span class="hljs-keyword">int</span> sig)</span></span>;
<span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">tgkill</span><span class="hljs-params">(<span class="hljs-keyword">int</span> tgid, <span class="hljs-keyword">int</span> tid, <span class="hljs-keyword">int</span> sig)</span></span>;
</div></code></pre>
<p>两个函数中，&quot;tid&quot;都是代表目标线程的PID，但<code>tgkill()</code>比<code>tkill()</code>多了一个&quot;tgid&quot;的参数。&quot;tgid&quot;是目标线程所在进程的PID，它可以用来防止向错误的线程发送信号。</p>
<p>发送方给目标线程发送信号时，可能目标线程已经因为某种原因退出了，按照Linux中PID的分配规则，退出线程/进程的PID可被分配给其他的线程/进程使用。这种情况下，如果使用<code>tkill()</code>，就可能出现将信号发送到不相干的线程上。引入&quot;tgid&quot;可以帮助进行目标线程所在进程的校验，这样出现错发的可能性就被大大地降低了。</p>
<h3 id="realtime-signals-sending">Realtime Signals Sending</h3>
<p>Advantages:</p>
<ul>
<li>Increased range. Standard signal only SIGUSR1 and SIGUSR2.
<ul>
<li>Linux kernel defines 32 realtime signals, numbered from 32 to 65.</li>
<li>User can use from <code>SIGRTMIN</code> (35), as LinuxThreads use 32-24 internally.</li>
</ul>
</li>
<li>Queued
<ul>
<li>In Linux, <code>RLIMIT_SIGPENDING</code> soft resource limit defines a limit on the number of signals that can be queued to all processes owned by a particular real user ID.</li>
</ul>
</li>
<li>Possible to specify data (int or pointer) that accompanies the signal.</li>
<li>The order of delivery is guaranteed. Lowest-numbered signal is delivered first.</li>
</ul>
<p>Sending realtime signals:</p>
<pre><code class="language-C++"><div>sigqueue(<span class="hljs-keyword">pid_t</span> pid, <span class="hljs-keyword">int</span> sig, <span class="hljs-keyword">const</span> <span class="hljs-keyword">union</span> sigval value)
</div></code></pre>
<p>realtime signals can be sent with kill() too, but without sigval, and it is not portable. Non-realtime signals can be sent with <code>sigqueue()</code> too, but the signal will not be queued.</p>
<p>Handing realtime signals:</p>
<ul>
<li>We can handle a realtime signal using a three-argument signal handler established using the <code>SA_SIGINFO</code> flag.</li>
<li>We can use a standard signal handler too, but then we won’t get sigval.</li>
</ul>
<h2 id="deliver-signals">Deliver Signals</h2>
<p><strong>Pending signals</strong></p>
<p>The set of pending signals is only a mask; it indicates whether or not a signal has occurred, but not how many times it has occurred. If multiple of the same signal are generated while being blocked, it is only delivered once later when the signal is unblocked.</p>
<p>Even if a process doesn’t block signals, it may receive fewer signals than are sent to it. This can happen if the signals are sent so fast that they arrive before the receiving process has a chance to be scheduled for execution by the kernel, with the result that the multiple signals are recorded just once in the process’s pending signal set.</p>
<p><strong>Blocked signals</strong></p>
<p>For each process, the kernel maintains a blocked signal mask—a set of signals whose delivery to the process is currently blocked. If a signal is blocked, delivery of that signal is delayed until it is unblocked by being removed from the process signal mask.</p>
<ul>
<li>Signal can be added to or removed from signal mask by <code>sigprocmask()</code></li>
</ul>
<p>If a process receives a signal that it is currently blocking, that signal is added to the
process’s set of pending signals bit mask.</p>
<ul>
<li>Pending signal mask can be examined by <code>sigpending()</code></li>
<li>Pending signal mask can be used for non-blocking signals as well.</li>
<li>For a blocked signal, even it's signal handler is SIG_IGN, it will not be ignored. It will be added into the pending mask/queue, this is because during the blocked period, it is possible the sig handler will be changed to something other than SIG_IGN.</li>
</ul>
<p><strong>When a signal is delivered?</strong></p>
<p>For asynchronou signals, Kernel delivers a pending signal to a process only at the next switch from kernel mode to user mode while executing that process. Which means below two cases:</p>
<ul>
<li>when the process is rescheduled after it earlier timed out (i.e., at the start of a time slice); or</li>
<li>At completion of a system call (delivery of the signal may cause a blocking system call to complete prematurely).</li>
</ul>
<p>在内核将CPU的控制权交还给用户进程之前，内核会查看进程对应的的TIF_SIGPENDING标志位，以判断即将执行的这个进程有无pending的信号需要处理。每次进程对应的bitmap和pending队列发生变化时，TIF_SIGPENDING标志位都会被重新计算，这样在发生切换的时候，内核就可以快速做出判断。</p>
<p><strong>Signal delivery order</strong></p>
<p>The delivery order and queuing characteristics of signals caught by a signal handler:</p>
<ul>
<li>standard signals are not queued,</li>
<li>realtime signals are queued and delivered lowest signal number first.</li>
</ul>
<p><strong>Interruption of system calls</strong></p>
<p>When system call is blocked, the signal for which we established a handler is delivered, and its signal handler is invoked. What to do after the signal handler returns?</p>
<ul>
<li>When a signal handler interrupts a blocked system call, system call fails with error EINTR, we can check that and call system call again.<pre><code class="language-C++"><div><span class="hljs-keyword">while</span> ((cnt = read(fd, buf, BUF_SIZE)) == <span class="hljs-number">-1</span> &amp;&amp; errno == EINTR)
<span class="hljs-keyword">continue</span>; <span class="hljs-comment">/* Do nothing loop body */</span>
<span class="hljs-keyword">if</span> (cnt == <span class="hljs-number">-1</span>) <span class="hljs-comment">/* read() failed with other than EINTR */</span>
errExit(<span class="hljs-string">&quot;read&quot;</span>);
</div></code></pre>
<ul>
<li>This can be replaced by glibc <code>NO_EINTR()</code> macro in &lt;unistd.h&gt;</li>
</ul>
<pre><code class="language-C++"><div>NO_EINTR(cnt = read(fd, buf, BUF_SIZE));
</div></code></pre>
</li>
<li>Another way is: we can specify the <code>SA_RESTART</code> flag when establishing the signal handler with sigaction(), so that system calls are automatically restarted by the kernel on the process’s behalf.
`- Not all system calls work for this. Most blocking I/O operations do work for this.</li>
<li>We can also use the <code>siginterrupt()</code> function to change the <code>SA_RESTART</code> setting associated with a signal.</li>
</ul>
<h2 id="waiting-signals">Waiting Signals</h2>
<p><strong>sigsuspend() system call</strong></p>
<p>atomically unblocking a signal and suspending the process. 进程调用<code>sigsuspend()</code>将自己置于<code>TASK_INTERRUPTIBLE</code>的睡眠态，等待被信号唤醒。</p>
<p>The rationale of it: to avoid the gap (and thus the race condition) between unblocking a signal and pause() call that waits for the signal.</p>
<p>Kernel implementation:</p>
<pre><code class="language-C++"><div><span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">sigsuspend</span><span class="hljs-params">(<span class="hljs-keyword">sigset_t</span> *<span class="hljs-built_in">set</span>)</span>
</span>{
	set_current_blocked(<span class="hljs-built_in">set</span>);
	<span class="hljs-keyword">while</span> (!signal_pending(current)) {
		__set_current_state(TASK_INTERRUPTIBLE);
		schedule();
	}
}
</div></code></pre>
<p>这里的参数&quot;set&quot;是一个信号屏蔽的bitmap，凡是不在这个&quot;set&quot;里的信号，都是进程敞开大门欢迎的，都可以用来唤醒进程。</p>
<p><strong>sigwaitinfo() system call</strong></p>
<p>It suspends execution of the process until one of the signals in the signal set pointed to by set is delivered. This is like synchronously accepting a signal.</p>
<ul>
<li>If one of the signals in set is already pending at the time of the call, <code>sigwaitinfo()</code> returns immediately.</li>
<li>The delivery order and queuing characteristics of signals are the same as for signals caught by a signal handler: standard signals are not queued, and realtime signals are queued and delivered lowest signal number first.</li>
<li>waiting for signals using <code>sigwaitinfo()</code> is somewhat faster than the combination of a signal handler plus sigsuspend()</li>
</ul>
<p><strong>signalfd() system call</strong></p>
<p>Linux implementation (not portable). It creates a special file descriptor which signals are directed to, we can then read signals from it using <code>read()</code>.</p>
<ul>
<li>A signalfd file descriptor can be monitored along with other descriptors using <code>select()</code>, <code>poll()</code>, and <code>epoll</code>.</li>
<li>Each call to <code>read()</code> returns as many <code>signalfd_siginfo</code> structures as there are signals pending and will fit in the supplied buffer.</li>
</ul>
<br>
<h1 id="special-signals">Special Signals</h1>
<h2 id="sigkill-and-sigstop">SIGKILL and SIGSTOP</h2>
<p>It is not possible to change the default action for them. It can’t be blocked, ignored, or caught by a handler.</p>
<ul>
<li>SIGKILL - sure kill - terminate the process</li>
<li>SIGSTOP - sure stop  - stop (suspend) the process</li>
</ul>
<p>init process can be SIGKILL'ed.</p>
<p>Another exception to sure kill:  TASK_UNINTERRUPTIBLE</p>
<p>the kernel may put a process to sleep, and there are two sleep states:</p>
<ul>
<li>TASK_INTERRUPTIBLE: S state in ps(1)</li>
<li>TASK_UNINTERRUPTIBLE: D state in ps(1) - The process is waiting on certain special classes of events, such as the completion of a disk I/O. The signal is not delivered until the process is out of this state.</li>
</ul>
<p>In rare circumstances, a process may remain hung in this state, perhaps as the result of a hardware failure, an NFS problem, or a kernel bug. In such cases, SIGKILL won’t terminate the hung process. If the underlying problem can’t otherwise be resolved, then we must restart the system in order to eliminate the process.</p>
<h2 id="sigcont">SIGCONT</h2>
<p>The SIGCONT signal is used to continue a process previously stopped by one of the stop signals (SIGSTOP, SIGTSTP, SIGTTIN, and SIGTTOU).</p>
<ul>
<li>If a process is currently stopped, the arrival of a SIGCONT signal always causes the process to resume, even if the process is currently blocking or ignoring SIGCONT.</li>
<li>Whenever SIGCONT is delivered to a process, any pending stop signals for the process are discarded</li>
<li>If any of the stop signals is delivered to a process, then any pending SIGCONT signal is automatically discarded.</li>
</ul>
<h2 id="sigchld">SIGCHLD</h2>
<p>表示子进程终止的SIGCHLD，它们的默认行为就是被进程忽略，除非进程注册处理函数来修改信号的默认行为</p>
<h2 id="hardware-generated-signals">Hardware generated signals</h2>
<p>SIGBUS, SIGFPE, SIGILL, and SIGSEGV can be generated as a consequence of a hardware exception.</p>
<p>For these signals, It doesn’t make sense to return from signal handlers to continue execution.</p>
<p>The correct way to deal with hardware-generated signals is either to accept their default action (process termination) or to write handlers that don’t perform a normal return.</p>
<p>Other than returning normally, a handler can complete execution by calling <code>_exit()</code> to terminate the process or by calling <code>siglongjmp()</code> (Section 21.2.1) to ensure that control passes to some point in the program other than the instruction that generated the signal.</p>
<br>
<h1 id="signal-handler">Signal Handler</h1>
<p>Per-process signal handler stored in <code>task_struct</code></p>
<p><img src="images/2022-03-03-15-40-12.png" alt=""></p>
<p><strong>Reentrant function</strong></p>
<p>Reentrant function can safely be simultaneously executed by multiple threads of execution in the same process.</p>
<p>A function is nonreentrant</p>
<ul>
<li>if it updates global or static data structures.
<ul>
<li><code>malloc()</code> and <code>free()</code> maintain a linked list of freed memory blocks available for reallocation from the heap.</li>
</ul>
</li>
<li>If they return information using statically allocated memory.
<ul>
<li><code>crypt()</code>, <code>getpwnam()</code>, <code>gethostbyname()</code>, and <code>getservbyname()</code>.</li>
</ul>
</li>
<li>if they use static data structures for their internal bookkeeping.
<ul>
<li>Members of the stdio library (<code>printf()</code>, <code>scanf()</code>, and so on), which update internal data structures for buffered I/O.</li>
</ul>
</li>
</ul>
<p><strong>async-signal-safe function</strong></p>
<p>It is one that the implementation guarantees to be safe when called from a signal handler.</p>
<p>A function is async-signal-safe either because it is reentrant or because it is not interruptible by a signal handler.</p>
<p><strong>Best practice of a signal handler</strong></p>
<ul>
<li>Only use async-signal-safe functions</li>
<li>If a signal handler uses a system call that changes <code>errno</code>, save value of <code>errno</code> on entry of a signal handler and restore <code>errno</code> on exit.</li>
<li>A global variable shared by signal handler and main program can be reasonable/useful.
<ul>
<li>one common design is to make a signal handler’s sole action the setting of a global flag. This flag is periodically checked by the main program, which then takes appropriate action in response to the delivery of the signal (and clears the flag).</li>
<li>using the <em>volatile</em> attribute to prevent compiler optimization.</li>
<li>Reading and writing global variables (such as long long time)may involve more than one machine language instruction, and a signal handler may interrupt the main program in the middle of such an instruction sequence. (We say that access to the variable is nonatomic.) We can use <code>sig_atomic_t</code> type.</li>
<li><code>sig_atomic_t</code> is often just a typedef (to some system specific integral type, generally int or long). And it is very important to use <em><code>volatile sig_atomic_t</code></em> (not just <code>sig_atomic_t</code> alone).</li>
</ul>
</li>
</ul>
<p><strong>Exit from signal handler</strong></p>
<p>Differnet ways to exit from a signal handler:</p>
<ul>
<li>Use <code>_exit()</code> to terminate the process. Beforehand, the handler may carry out some cleanup actions. Note that we can’t use <code>exit()</code> to terminate a signal handler, because It is unsafe because it flushes stdio buffers prior to calling <code>_exit()</code>.</li>
<li>Use <code>kill()</code> or <code>raise()</code> to send a signal that kills the process (i.e., a signal whose default action is process termination).</li>
<li>Perform a nonlocal <code>goto</code> from the signal handler.
<ul>
<li>For example, upon receipt of a <code>SIGINT</code> signal (normally generated by typing Control-C), the shell performs a nonlocal <code>goto</code> to return control to its main input loop (and thus read a new command).</li>
<li>Use <code>sigsetjmp</code> and <code>siglongjump</code> to avoid portability issues.</li>
</ul>
</li>
<li>Use the <code>abort()</code> function to terminate the process with a core dump.
<ul>
<li>The <code>abort()</code> function terminates the calling process by raising a <code>SIGABRT</code> signal.</li>
<li>It is guaranteed this way: if the process still hasn’t terminated after raising <code>SIGABRT</code> once (i.e., a handler catches the signal and returns, so that execution of <code>abort()</code> is resumed), <code>abort()</code> resets the handling of <code>SIGABRT</code> to <code>SIG_DFL</code> and raises a second <code>SIGABRT</code>, which is guaranteed to kill the process.</li>
<li>If <code>abort()</code> does successfully terminate the process, then it also flushes and closes stdio streams.</li>
</ul>
</li>
</ul>
<p><strong>Child process exit from signal handler</strong></p>
<p>termination status of a process is available to its parent via <code>wait()</code> or <code>waitpid()</code>. For example, calling <code>_exit(EXIT_SUCCESS)</code> from the signal handler will make it appear to the parent process that the child terminated successfully.</p>
<p>If the child needs to inform the parent that it terminated because of a signal, then the child’s signal handler should first disestablish itself, and then raise the same signal again, which this time will terminate the process.</p>
<pre><code class="language-C++"><div><span class="hljs-function"><span class="hljs-keyword">void</span> <span class="hljs-title">handler</span><span class="hljs-params">(<span class="hljs-keyword">int</span> sig)</span> </span>{
  <span class="hljs-comment">/* Perform cleanup steps */</span>
  signal(sig, SIG_DFL); <span class="hljs-comment">/* Disestablish handler */</span>
  raise(sig); <span class="hljs-comment">/* Raise signal again */</span>
}
</div></code></pre>
<h2 id="signal-handler-and-thread">Signal handler and thread</h2>
<p>根据POSIX标准的定义，进程内的所有线程共享进程的信号处理函数，当进程内的一个线程为某个信号注册了处理函数，另一个线程可以更改这个处理函数。在Linux的实现中，线程作为独立的调度实体也有自己的task_struct，同一进程的不同线程的task_struct的&quot;sighand&quot;将指向同一个包含信号处理函数列表的sighand_struct。</p>
<p><img src="images/2022-03-03-17-05-50.png" alt=""></p>
<p>但是，每个线程可以有单独的pending bitmap/queue和block bitmap。</p>
<ul>
<li>如果一个信号是发送给线程的，那么内核在递送该信号时，会将它放入线程私有的pending bitmap/queue中，之后根据目标线程的block位图的设置，直接由目标线程处理就可以了。</li>
<li>如果信号是发送给一个进程的，那么该信号在递送时将被内核放入进程的pending bitmap/queue中，由进程内的所有线程共享。接下来，内核会从进程的各个线程中，挑选一个block位图中没有屏蔽该信号的线程，来执行对应的信号处理函数，其中，进程的主线程将被内核优先选择。</li>
<li>当一个线程即将被内核调度执行，而该线程私有的pending bitmap/queue和所在进程共享的pending bitmap/queue上都有待处理的信号时，内核将优先向线程递送私有的pending bitmap/queue上的信号</li>
</ul>
<p><img src="images/2022-03-03-17-06-44.png" alt=""></p>
<h1 id="kernel-internals">Kernel Internals</h1>
<p>一个信号的相关信息在内核中用siginfo_t结构体表示：</p>
<pre><code class="language-C++"><div><span class="hljs-keyword">siginfo_t</span>{
    <span class="hljs-keyword">int</span> si_signo;
    <span class="hljs-keyword">int</span> si_sicode;
    <span class="hljs-keyword">union</span> __sifields _sifields;
    ...
}
</div></code></pre>
<ul>
<li><code>si_signo</code>是信号的编号，从1到64的值都是合法的。</li>
<li><code>si_sicode</code>记录了信号的来源，比如<code>SI_USER</code>表示信号是由进程调用<code>kill()</code>发出的，<code>SI_QUEUE</code>是由进程调用<code>sigqueue()</code>发出的，<code>SI_KERNEL</code>则说明该信号由内核产生的。</li>
<li><code>_sifields</code>对不同的信号会有不同的含义，通常包括信号发送进程的<code>si_pid</code>，发送进程所属user的<code>si_uid</code>等。对于由<code>sigqueue()</code>发送的信号，还包括&quot;<code>sigval</code>&quot;参数所携带的附加信息。</li>
</ul>
<p>内核在截获到一个进程发送的信号后，会首先做一系列的检查，比如该信号的值是否合法啦，进程有没有发送这个信号的权限啦。如果检查通过，就调用copy_from_user()将该信号的相关信息复制到siginfo_t结构体中。接下来就是将信号向目标进程递送(deliver)啦。</p>
<p><img src="images/2022-03-03-13-18-06.png" alt=""></p>
<p>对于每一个目标进程，内核会用一个位图(bitmap)来记录信号的处理状态。如果一个信号还未被目标进程处理，那么它就是挂起/未决(pending)的状态。内核在向目标进程递送信号时，会查看进程对应的bitmap中，该信号对应的bit是否有挂起的信号。</p>
<ul>
<li>不可靠信号：signo [1, 31], 如果当前有pending的信号，按照Unix传统的做法，内核将直接丢弃这一信号。</li>
<li>可靠信号: realtime signals, 内核会为每个进程维护一组队列(queue)，有信号pending时，就将新来的信号排队(enqueue)</li>
</ul>
<p>在代码实现中，bitmap用<code>sigset_t</code>表示，而队列就是一个双向链表，链表头结点包含在进程对应的<code>task_struct</code>中。</p>
<pre><code class="language-C++"><div><span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">sigpending</span> {</span>
	<span class="hljs-class"><span class="hljs-keyword">struct</span> <span class="hljs-title">list_head</span> <span class="hljs-title">list</span>;</span>
	<span class="hljs-keyword">sigset_t</span> signal;
};
</div></code></pre>

    </body>
    </html>